<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Abdullah Khabir">
    <meta name="description" content="AK Solutions">
    <meta name="keywords" content="blog,developer,personal,ethical_hacking,code,devops,linux,archlinux,bspwm,bash,sh,debian">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Encrypted Arch Linux installation"/>
<meta name="twitter:description" content="Encrypted Arch Linux installation"/>

    <meta property="og:title" content="Encrypted Arch Linux installation" />
<meta property="og:description" content="Encrypted Arch Linux installation" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://abdullah.solutions/encrypted-archlinux/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-01-03T00:00:00+00:00" />



    
      <base href="https://abdullah.solutions/encrypted-archlinux/">
    
    <title>
  Encrypted Arch Linux installation Â· Abdullah Khabir
</title>

    
      <link rel="canonical" href="https://abdullah.solutions/encrypted-archlinux/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400,600,300,800,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://abdullah.solutions/css/coder.min.9f38ad26345e306650770a3b91475e09efa3026c59673a09eff165cfa8f1a30e.css" integrity="sha256-nzitJjReMGZQdwo7kUdeCe&#43;jAmxZZzoJ7/Flz6jxow4=" crossorigin="anonymous" media="screen" />
    

    

    

    

    

    

    <link rel="icon" type="image/png" href="https://abdullah.solutions/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://abdullah.solutions/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.101.0" />
  </head>

  
  
  <body class="colorscheme-light">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://abdullah.solutions/">
      Abdullah Khabir
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://abdullah.solutions/posts/">BLOG</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Encrypted Arch Linux installation</h1>
        </div>
        <div class="description">
          <span class="title">Encrypted Arch Linux installation</span>
        </div>
        <div class="post-meta">
          
          <div class="date">
            <span class="posted-on">
              <time datetime='2020-01-03T00:00:00Z'>
                January 3, 2020
              </time>
            </span>
          </br>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              5 minutes
            </span>
          </div>
        </div>
      </header>

      <div>
        
        <h1 id="whats-arch-linux">What&rsquo;s <strong>Arch Linux</strong>?</h1>
<p><img src="https://abdullah.solutions/images/arch.jpg" alt="Arch Linux"></p>
<p><a href="https://archlinux.org" target="_blank" >Arch Linux</a>
 is a free
and open source linux distribution based on the rule Keep it Simple.</p>
<h3 id="installation">Installation</h3>
<p>Arch Linux has no graphical installer. You have to install using CLI.</p>
<h3 id="installation-media-creation">Installation media creation</h3>
<p>Go to <a href="https://archlinux.org/download" target="_blank" >Downloads page</a>
 and select a nearby mirror. Download the iso file. If you&rsquo;re on Windows, you can use rufus to create a bootable media.</p>
<p>On linux, you can use <strong>dd</strong>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dd <span style="color:#2838b0">if</span><span style="color:#666">=</span>downloaded iso file <span style="color:#b04040">of</span><span style="color:#666">=</span>/dev/sdX <span style="color:#b04040">status</span><span style="color:#666">=</span>progress
</span></span></code></pre></div><p>where X is your USB device&rsquo;s ID. Don&rsquo;t use a single partition. Use the whole
device.</p>
<h3 id="boot-the-media">Boot the media</h3>
<p>Insert the USB device and reboot the computer. Press the button configured to
come boot options up. Choose your USB device from boot options.</p>
<h3 id="connect-to-internet">Connect to internet</h3>
<p>If you have ethernet, Arch linux iso will detect it. If you have a wireless
connection, you have to connect it manually.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wpa_passphrase <span style="color:#b83838">&#39;wifi APN&#39;</span> <span style="color:#b83838">&#39;wifi password&#39;</span> &gt;&gt; /etc/wpa_supplicant/wpa_supplicant.conf
</span></span><span style="display:flex;"><span>wpa_supplicant -Bc /etc/wpa_supplicant/wpa_supplicant.conf -i <span style="color:#b83838">&#39;wifi interface&#39;</span>
</span></span><span style="display:flex;"><span>dhclient
</span></span></code></pre></div><p>where wifi APN is the access point name you get when you scan for your wifi. And
wifi interface you can get using iwconfig. It might be wlp3s0 or wlan0.
Or you can use wifi-menu.</p>
<p>Now ping some website <strong>abdullah.today</strong> to check if you&rsquo;re connected to
internet or not.</p>
<h3 id="partitioning">Partitioning</h3>
<p>There are multiple ways to encrypt the installation. One of them in LUKS on lvm.
It&rsquo;s straightforward.</p>
<p>Assuming you have a UEFI system and sda is your drive where you wanna install
archlinux.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gdisk /dev/sda
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>GPT fdisk <span style="color:#666">(</span>gdisk<span style="color:#666">)</span> version 1.0.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Partition table scan:
</span></span><span style="display:flex;"><span>  MBR: protective
</span></span><span style="display:flex;"><span>  BSD: not present
</span></span><span style="display:flex;"><span>  APM: not present
</span></span><span style="display:flex;"><span>  GPT: present
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Found valid GPT with protective MBR<span style="color:#888">;</span> using GPT.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#666">(</span>? <span style="color:#2838b0">for</span> <span style="color:#388038">help</span><span style="color:#666">)</span>: o
</span></span><span style="display:flex;"><span>This option deletes all partitions and creates a new protective MBR.
</span></span><span style="display:flex;"><span>Proceed? <span style="color:#666">(</span>Y/N<span style="color:#666">)</span>: Y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#666">(</span>? <span style="color:#2838b0">for</span> <span style="color:#388038">help</span><span style="color:#666">)</span>: n
</span></span><span style="display:flex;"><span>Partition number <span style="color:#666">(</span>1-128, default 1<span style="color:#666">)</span>: 
</span></span><span style="display:flex;"><span>First sector <span style="color:#666">(</span>34-242187466, <span style="color:#b04040">default</span> <span style="color:#666">=</span> 2048<span style="color:#666">)</span> or <span style="color:#666">{</span>+-<span style="color:#666">}</span>size<span style="color:#666">{</span>KMGTP<span style="color:#666">}</span>: 
</span></span><span style="display:flex;"><span>Last sector <span style="color:#666">(</span>2048-242187466, <span style="color:#b04040">default</span> <span style="color:#666">=</span> 242187466<span style="color:#666">)</span> or <span style="color:#666">{</span>+-<span style="color:#666">}</span>size<span style="color:#666">{</span>KMGTP<span style="color:#666">}</span>:
</span></span><span style="display:flex;"><span>+512M
</span></span><span style="display:flex;"><span>Current <span style="color:#388038">type</span> is <span style="color:#b83838">&#39;Linux filesystem&#39;</span>
</span></span><span style="display:flex;"><span>Hex code or GUID <span style="color:#666">(</span>L to show codes, <span style="color:#b04040">Enter</span> <span style="color:#666">=</span> 8300<span style="color:#666">)</span>: EF00
</span></span><span style="display:flex;"><span>Changed <span style="color:#388038">type</span> of partition to <span style="color:#b83838">&#39;EFI System&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#666">(</span>? <span style="color:#2838b0">for</span> <span style="color:#388038">help</span><span style="color:#666">)</span>: n
</span></span><span style="display:flex;"><span>Partition number <span style="color:#666">(</span>2-128, default 2<span style="color:#666">)</span>: 
</span></span><span style="display:flex;"><span>First sector <span style="color:#666">(</span>34-242187466, <span style="color:#b04040">default</span> <span style="color:#666">=</span> 1050624<span style="color:#666">)</span> or <span style="color:#666">{</span>+-<span style="color:#666">}</span>size<span style="color:#666">{</span>KMGTP<span style="color:#666">}</span>: 
</span></span><span style="display:flex;"><span>Last sector <span style="color:#666">(</span>1050624-242187466, <span style="color:#b04040">default</span> <span style="color:#666">=</span> 242187466<span style="color:#666">)</span> or <span style="color:#666">{</span>+-<span style="color:#666">}</span>size<span style="color:#666">{</span>KMGTP<span style="color:#666">}</span>: 
</span></span><span style="display:flex;"><span>Current <span style="color:#388038">type</span> is <span style="color:#b83838">&#39;Linux filesystem&#39;</span>
</span></span><span style="display:flex;"><span>Hex code or GUID <span style="color:#666">(</span>L to show codes, <span style="color:#b04040">Enter</span> <span style="color:#666">=</span> 8300<span style="color:#666">)</span>: <span style="color:#444">8309</span>
</span></span><span style="display:flex;"><span>Changed <span style="color:#388038">type</span> of partition to <span style="color:#b83838">&#39;Linux LUKS&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Command <span style="color:#666">(</span>? <span style="color:#2838b0">for</span> <span style="color:#388038">help</span><span style="color:#666">)</span>: p
</span></span><span style="display:flex;"><span>Disk /dev/sda: <span style="color:#444">242187500</span> sectors, 115.5 GiB
</span></span><span style="display:flex;"><span>Logical sector size: <span style="color:#444">512</span> bytes
</span></span><span style="display:flex;"><span>Disk identifier <span style="color:#666">(</span>GUID<span style="color:#666">)</span>: 569FFB67-6969-49E4-B999-15A681987564
</span></span><span style="display:flex;"><span>Partition table holds up to <span style="color:#444">128</span> entries
</span></span><span style="display:flex;"><span>First usable sector is 34, last usable sector is <span style="color:#444">242187466</span>
</span></span><span style="display:flex;"><span>Partitions will be aligned on 2048-sector boundaries
</span></span><span style="display:flex;"><span>Total free space is <span style="color:#444">2014</span> sectors <span style="color:#666">(</span>1007.0 KiB<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Number  Start <span style="color:#666">(</span>sector<span style="color:#666">)</span>    End <span style="color:#666">(</span>sector<span style="color:#666">)</span>  Size       Code  Name
</span></span><span style="display:flex;"><span>   <span style="color:#444">1</span>            <span style="color:#444">2048</span>         <span style="color:#444">1050623</span>   512.0 MiB   EF00  EFI System
</span></span><span style="display:flex;"><span>   <span style="color:#444">2</span>         <span style="color:#444">1050624</span>       <span style="color:#444">242187466</span>   115.0 GiB   <span style="color:#444">8309</span>  Linux LUKS
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#388038">command</span> <span style="color:#666">(</span>? <span style="color:#2838b0">for</span> <span style="color:#388038">help</span><span style="color:#666">)</span>: w
</span></span></code></pre></div><p>Type o and then Y.</p>
<p>Type n to create a new partition. Select 1 to create a very first partition for
EFI. Hit enter and then type +512M to create a 512 Mbs partition. Enter ef00 as
partition type.</p>
<p>Again type n to create a new partition. Select 2. Hit enter and again enter to
give it rest of the storage if you don&rsquo;t wanna install some other operating
system. Hex code for LUKS is 8309 but you can go without it. By default it will
be 8300 (linux filesystem).</p>
<p>Type p to check if everything is fine. And once satisfied, type w and hit enter
to save the work.</p>
<h3 id="create-file-systems">Create file systems</h3>
<p>First, create a filesystem for EFI.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkfs.vfat -F32 /dev/sda1
</span></span></code></pre></div><p>Now create a LUKS container.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> cryptsetup luksFormat /dev/sda2
</span></span></code></pre></div><p>It will ask you to confirm. Type YES in all uppercase. Then choose a good
passphrase. Write it if you can&rsquo;t memorize it. Once forgotten, you can&rsquo;t recover
it.</p>
<p>Now open the new container.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> cryptsetup open /dev/sda2 cryptlvm
</span></span></code></pre></div><p>Create a physical volume in this LUKS container.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> pvcreate /dev/mapper/cryptlvm
</span></span></code></pre></div><p>Create a volume group. I&rsquo;ll name it nix.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> vgcreate nix /dev/mapper/cryptlvm
</span></span></code></pre></div><p>Create logical volumes on volume group. I&rsquo;m creating three, one for encrypted swap
and another for home and last one for root.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> lvcreate -L 8G nix -n swap
</span></span><span style="display:flex;"><span> lvcreate -L 25G nix -n root
</span></span><span style="display:flex;"><span> lvcreate -l +100%FREE nix -n home
</span></span></code></pre></div><p>Now create filesystems.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mkfs.ext4 /dev/mapper/nix-root
</span></span><span style="display:flex;"><span> mkfs.ext4 /dev/mapper/nix-home
</span></span><span style="display:flex;"><span> mkswap /dev/mapper/nix-swap
</span></span></code></pre></div><p>Mount them.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mount /dev/mapper/nix-root /mnt
</span></span><span style="display:flex;"><span> mkdir /mnt/home
</span></span><span style="display:flex;"><span> mkdir /mnt/boot
</span></span><span style="display:flex;"><span> mount /dev/mapper/nix-home /mnt/home
</span></span><span style="display:flex;"><span> mount /dev/sda1 /mnt/boot
</span></span></code></pre></div><p>Turn the swap partition on.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> swapon /dev/mapper/nix-swap
</span></span></code></pre></div><h3 id="install-the-base-system">Install the base system</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> pacstrap /mnt base base-devel linux linux-firmware
</span></span></code></pre></div><h3 id="generate-fstab">Generate fstab</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</span></span></code></pre></div><blockquote>
<p><strong><em>NOTE:</em></strong> If you&rsquo;re using an SSD, replace relatime with noatime in  /mnt/etc/fstab except boot partition.</p>
</blockquote>
<h3 id="chroot-into-new-system">chroot into new system.</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> arch-chroot /mnt
</span></span></code></pre></div><p>Set the timezone.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ln -s /usr/share/zoneinfo/Asia/Karachi /etc/localtime
</span></span><span style="display:flex;"><span> hwclock --systohc
</span></span></code></pre></div><p>Replace Asia with your continent and Karachi with city.</p>
<p>Set hostname</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#388038">echo</span> nix &gt; /etc/hostname
</span></span></code></pre></div><p>Replace nix with name you wanna give your machine to.</p>
<p>Set locales</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> vim /etc/locale.gen
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_HK ISO-8859-1  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_IE.UTF-8 UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_IE ISO-8859-1  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_IE@euro ISO-8859-15  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_IL UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_IN UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_NG UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_NZ.UTF-8 UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_NZ ISO-8859-1  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_PH.UTF-8 UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_PH ISO-8859-1  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_SC.UTF-8 UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_SG.UTF-8 UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_SG ISO-8859-1  </span>
</span></span><span style="display:flex;"><span>  en_US.UTF-8 UTF-8  
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_US ISO-8859-1  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_ZA.UTF-8 UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_ZA ISO-8859-1  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_ZM UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_ZW.UTF-8 UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#en_ZW ISO-8859-1  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#eo UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#es_AR.UTF-8 UTF-8  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#es_AR ISO-8859-1  </span>
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">#es_BO.UTF-8 UTF-8  </span>
</span></span></code></pre></div><p>Uncomment en_US.UTF-8 UTF-8 . (remove # from the beginning)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#388038">echo</span> <span style="color:#b04040">LANG</span><span style="color:#666">=</span>en_US.UTF-8 &gt; /etc/locale.conf
</span></span><span style="display:flex;"><span> locale-gen
</span></span></code></pre></div><p>Install some necessary software.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> pacman -S wpa_supplicant dhclient dialog
</span></span></code></pre></div><p>Create a user.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> useradd -m -G wheel <span style="color:#b83838">&#39;username&#39;</span>
</span></span><span style="display:flex;"><span> passwd <span style="color:#b83838">&#39;username&#39;</span>
</span></span></code></pre></div><p>Create root password</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> passwd
</span></span></code></pre></div><h3 id="mkinitcpio-configuration">mkinitcpio configuration</h3>
<p>Edit the file <strong>/etc/mkinitcpio.conf</strong>. Copy this line or write in order in hooks line. Order matters so don&rsquo;t ignore or you will get un-bootable system.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> vim /etc/mkinitcpio.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#b04040">HOOKS</span><span style="color:#666">=(</span>base udev autodetect keyboard keymap consolefont modconf block encrypt lvm2 filesystems resume fsck<span style="color:#666">)</span>
</span></span></code></pre></div><p>Generate mkinitcpio</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkinitcpio -p linux
</span></span></code></pre></div><h3 id="install-bootloader">Install bootloader</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> bootctl install 
</span></span></code></pre></div><p>Create entries.</p>
<p>Create a file <strong>/boot/loader/entries/arch.conf</strong>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> vim /boot/loader/entries/arch.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>title	ArchLinux
</span></span><span style="display:flex;"><span>linux	/vmlinuz-linux
</span></span><span style="display:flex;"><span>initrd	/initramfs-linux.img
</span></span><span style="display:flex;"><span>options <span style="color:#b04040">cryptdevice</span><span style="color:#666">=</span><span style="color:#b04040">UUID</span><span style="color:#666">=</span>&lt;YOUR-PARTITION-UUID&gt;:lvm:allow-discards <span style="color:#b04040">resume</span><span style="color:#666">=</span>/dev/mapper/nix-swap <span style="color:#b04040">root</span><span style="color:#666">=</span>/dev/mapper/nix-root rw quiet
</span></span></code></pre></div><p>Where UUID you can get using blkid. It would be in /dev/sda2.</p>
<h3 id="un-mount-and-reboot">Un-mount and reboot</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#388038">exit</span>
</span></span><span style="display:flex;"><span> umount /mnt
</span></span><span style="display:flex;"><span> reboot
</span></span></code></pre></div><p>Remove the USB device. And enjoy your new archlinux encrypted installation.</p>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
    
      
        Â© 2022
      
       Abdullah Khabir 
    
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
